<!DOCTYPE html>
<html>
<head>
    <title>YouTube Queue</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&family=Signika:wght@400;500;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css">
    
    <style id="classic-theme">
        body.classic-theme {
            font-family: 'Open Sans', sans-serif;
            background-color: #E6E6E6;
            color: #4D4D4F;
        }
        .classic-theme .title-box {
            background-color: #FFFFFF;
            border-radius: 0 24px 0 0;
            padding: 16px;
            margin-bottom: 20px;
        }
        .classic-theme h1, .classic-theme h2 {
            font-family: 'Signika', sans-serif;
            font-weight: 700;
            color: #101820;
        }
        .classic-theme h1 { font-size: 2.5em; margin: 0; }
        .classic-theme h2 { font-size: 1.8em; border-bottom: 2px solid #E02C90; padding-bottom: 5px; }
        .classic-theme #add-form { display: flex; margin-bottom: 20px; }
        .classic-theme #url-input { flex-grow: 1; padding: 12px 20px; border: 2px solid #5C2482; border-radius: 12px; font-family: 'Open Sans', sans-serif; font-size: 1em; }
        .classic-theme button[type="submit"] { font-family: 'Signika', sans-serif; font-weight: 700; background: linear-gradient(135deg, #5C2482, #A63DB8); color: #FFFFFF; border: none; border-radius: 12px; padding: 12px 20px; cursor: pointer; margin-left: 10px; transition: transform 0.2s; }
        .classic-theme button[type="submit"]:hover { transform: scale(1.05); }
        .classic-theme .queue-item { display: flex; align-items: center; margin: 15px 0; padding: 15px; background-color: #FFFFFF; border-radius: 16px; border: 1px solid #E6E6E6; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .classic-theme .queue-item img { width: 120px; height: 90px; margin-right: 15px; border-radius: 8px; }
        .classic-theme .item-details { flex-grow: 1; }
        .classic-theme .item-title { font-family: 'Signika', sans-serif; font-weight: 700; font-size: 1.2em; color: #101820; }
        .classic-theme .progress-bar { width: 100%; background-color: #E6E6E6; border-radius: 8px; margin: 5px 0; }
        .classic-theme .progress { width: 0%; height: 20px; background-color: #5C2482; border-radius: 8px; text-align: center; line-height: 20px; color: white; transition: width 0.5s; }
        .classic-theme .status-text { font-family: 'Open Sans', sans-serif; font-size: 0.9em; color: #4D4D4F; }
    </style>

    <style id="material-light-theme" disabled>
        body.material-light-theme { background-color: #f5f5f5; color: #212121; font-family: 'Roboto', sans-serif; }
        .material-light-theme .mdc-card { margin: 16px 0; }
        .material-light-theme .mdc-text-field { width: 100%; }
        .material-light-theme .mdc-linear-progress { width: 100%; margin-top: 8px; }
    </style>

    <style id="material-dark-theme" disabled>
        body.material-dark-theme { background-color: #121212; color: #ffffff; font-family: 'Roboto', sans-serif; }
        .material-dark-theme .mdc-card { background-color: #1e1e1e; color: #ffffff; margin: 16px 0; }
        .material-dark-theme .mdc-text-field--filled { background-color: #333; }
        .material-dark-theme .mdc-text-field .mdc-floating-label { color: #bbb; }
        .material-dark-theme .mdc-text-field__input { color: #fff; }
        .material-dark-theme .mdc-linear-progress { background-color: #444; }
        .material-dark-theme .mdc-linear-progress-bar-inner { background-color: #6200ee; }
        .material-dark-theme h1, .material-dark-theme h2 { color: #fff; }
    </style>
</head>
<body>
    <div class="container">
        <div class="title-box">
            <h1>YouTube Queue</h1>
        </div>

        <div style="display: flex; justify-content: flex-end; margin-bottom: 20px;">
            <select id="theme-switcher">
                <option value="classic">Classic</option>
                <option value="material-light">Material Light</option>
                <option value="material-dark">Material Dark</option>
            </select>
        </div>

        <form id="add-form">
            <div class="mdc-text-field mdc-text-field--filled" style="flex-grow: 1;">
                <input class="mdc-text-field__input" id="url-input" type="text" required>
                <label class="mdc-floating-label" for="url-input">Enter YouTube URL</label>
                <div class="mdc-line-ripple"></div>
            </div>
            <button class="mdc-button mdc-button--raised" type="submit" style="margin-left: 10px;">
                <span class="mdc-button__label">Add to Queue</span>
            </button>
        </form>

        <h2>Current Queue</h2>
        <div id="queue-list">
            {% for item in queue %}
            <div class="mdc-card queue-item" data-url="{{ item.url }}">
                <div style="display: flex; padding: 16px;">
                    <img src="{{ item.thumbnail }}" alt="thumbnail" style="width: 120px; height: 90px; margin-right: 16px; border-radius: 4px;">
                    <div class="item-details" style="flex-grow: 1;">
                        <div class="item-title">{{ item.title }}</div>
                        <div class="status-text">Waiting...</div>
                        <div class="mdc-linear-progress progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0">
                            <div class="mdc-linear-progress__buffer"></div>
                            <div class="mdc-linear-progress__bar mdc-linear-progress__primary-bar">
                                <span class="mdc-linear-progress__bar-inner"></span>
                            </div>
                            <div class="mdc-linear-progress__bar mdc-linear-progress__secondary-bar">
                                <span class="mdc-linear-progress__bar-inner"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script>
        const socket = io();
        mdc.autoInit();

        const themeSwitcher = document.getElementById('theme-switcher');
        const classicTheme = document.getElementById('classic-theme');
        const materialLightTheme = document.getElementById('material-light-theme');
        const materialDarkTheme = document.getElementById('material-dark-theme');

        function setTheme(theme) {
            classicTheme.disabled = true;
            materialLightTheme.disabled = true;
            materialDarkTheme.disabled = true;
            document.body.className = '';

            if (theme === 'classic') {
                classicTheme.disabled = false;
                document.body.classList.add('classic-theme');
            } else if (theme === 'material-light') {
                materialLightTheme.disabled = false;
                document.body.classList.add('material-light-theme');
            } else if (theme === 'material-dark') {
                materialDarkTheme.disabled = false;
                document.body.classList.add('material-dark-theme');
            }
            localStorage.setItem('theme', theme);
        }

        themeSwitcher.addEventListener('change', (event) => {
            setTheme(event.target.value);
        });

        const savedTheme = localStorage.getItem('theme') || 'classic';
        themeSwitcher.value = savedTheme;
        setTheme(savedTheme);

        document.getElementById('add-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const urlInput = document.getElementById('url-input');
            const url = urlInput.value;
            if (!url) return;

            fetch('/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `url=${encodeURIComponent(url)}`
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    urlInput.value = '';
                } else {
                    alert("Error: " + data.error);
                }
            });
        });

        socket.on('connect', function() {
            console.log('Connected to server');
        });

        socket.on('status', function(data) {
            const item = document.querySelector(`.queue-item[data-url="${data.url}"]`);
            if (item) {
                const progressBar = item.querySelector('.mdc-linear-progress');
                const statusText = item.querySelector('.status-text');
                if(progressBar) {
                    const progress = parseFloat(data.progress) / 100;
                    progressBar.MDCLinearProgress.progress = progress;
                }
                statusText.textContent = `Speed: ${data.speed} - ETA: ${data.eta}`;
            }
        });

        socket.on('download_complete', function(data) {
            const item = document.querySelector(`.queue-item[data-url="${data.url}"]`);
            if (item) {
                item.remove();
            }
        });

        socket.on('download_error', function(data) {
            const item = document.querySelector(`.queue-item[data-url="${data.url}"]`);
            if (item) {
                const statusText = item.querySelector('.status-text');
                statusText.textContent = `Error: ${data.error}`;
            }
        });

        function fetchAndRenderQueue() {
            fetch('/status')
                .then(response => response.json())
                .then(data => {
                    const queueList = document.getElementById('queue-list');
                    queueList.innerHTML = '';
                    data.forEach(item => {
                        const div = document.createElement('div');
                        div.className = 'mdc-card queue-item';
                        div.dataset.url = item.url;
                        div.innerHTML = `
                            <div style="display: flex; padding: 16px;">
                                <img src="${item.thumbnail}" alt="thumbnail" style="width: 120px; height: 90px; margin-right: 16px; border-radius: 4px;">
                                <div class="item-details" style="flex-grow: 1;">
                                    <div class="item-title">${item.title}</div>
                                    <div class="status-text">Waiting...</div>
                                    <div class="mdc-linear-progress progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0">
                                        <div class="mdc-linear-progress__buffer"></div>
                                        <div class="mdc-linear-progress__bar mdc-linear-progress__primary-bar">
                                            <span class="mdc-linear-progress__bar-inner"></span>
                                        </div>
                                        <div class="mdc-linear-progress__bar mdc-linear-progress__secondary-bar">
                                            <span class="mdc-linear-progress__bar-inner"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                        queueList.appendChild(div);
                        mdc.autoInit(div);
                    });
                });
        }

        // Initial load
        fetchAndRenderQueue();

    </script>
</body>
</html>
